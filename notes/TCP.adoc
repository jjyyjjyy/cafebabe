= TCP
:icons: font
:source-highlighter: highlightjs
:highlightjs-theme: idea
:sectlinks:
:sectnums:
:stem:
:toc: left
:toclevels: 3
:toc-title: 目录
:tabsize: 4
:docinfo: shared


== 协议分层模型

|===
| OSI参考模型 | TCP/IP参考模型 | 常见协议

| 应用层
.3+|应用层

.3+|HTTP FTP SMTP SSH

| 表示层

| 会话层

| 传输层

| 传输层

| TCP UDP RTP SCTP

| 网络层

| 互联网层

| IP ICMP

| 数据链路层

.2+|网络接口层

.2+| IEEE802.3 IEEE802.11

| 物理层

|===

[cols="^1,^1,^2,^2,^4"]
.数据包格式
|===
| 以太网首部 | IP首部 | TCP首部 | HTTP请求/响应头 | 数据

.3+| L2
| L3
| L4
| L7
| 应用程序

| <20字节>
| <20~60字节>
2+|<MSS>

4+| <MTU: 1500/9000>

|===

== TCP协议简介

> `TCP` 是一种面向连接的、可靠的、有序的、基于字节流的传输层通信协议. [RFC9293]

* 面向连接: 确认通信设备间连接的开始和结束, 同时通过拥塞控制机制保障端到端的高可靠通信.
* 可靠的: 通过ACK确认机制确保数据传输完成.
* 有序的: 通过SEQ机制对收到的分段顺序进行管理.
* 基于字节流: 无边界.

=== 报文格式

[packetdiag]
----
packetdiag {
  colwidth = 32;
  node_height = 60;
  default_fontsize = 16;

  0-15: 发  送  方  口  号;
  16-31: 目  的  地  端 口  号;
  32-63: 序  列  号(SEQ);
  64-95: 确  认  应  答  号(ACK);
  96-99: 数  据  偏  移;
  100-102: 保  留  位;
  103: NS [rotate = 270];
  104: CWR [rotate = 270];
  105: ECE [rotate = 270];
  106: URG [rotate = 270];
  107: ACK [rotate = 270];
  108: PSH [rotate = 270];
  109: RST [rotate = 270];
  110: SYN [rotate = 270];
  111: FIN [rotate = 270];
  112-127: 窗  口  大  小;
  128-143: 校  验  和;
  144-159: 紧  急  指  针;
  160-191: 选  项 | 填  充;
  192-223: 数  据 [colheight = 3];
}
----

== TCP连接

=== 三次握手

=== 四次挥手

=== 协议选项

== 拥塞控制

== 工具

== 常见问题及排查思路

